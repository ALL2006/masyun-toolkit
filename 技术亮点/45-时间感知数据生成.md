# 45 - 时间感知数据生成 ⏰

> **难度**: ⭐⭐⭐⭐ | **价值**: 🔥🔥🔥🔥 | **创新度**: ⭐⭐⭐⭐⭐ |

---

## 📌 技术概述

### 核心创新

我们的Mock数据不是静态随机数，而是**时间感知的动态数据**：

| 时间维度 | 系数 | 效果 |
|---------|------|------|
| **小时系数** | 0.5-1.5 | 白天高峰1.3-1.5倍 |
| **周末系数** | 1.0-1.35 | 周六1.35倍 |
| **季节系数** | 0.8-1.25 | 暑期1.25倍 |
| **天气系数** | 0.5-1.0 | 暴雨0.5倍 |

### 技术成果

| 指标 | 数值 |
|-----|-----|
| 时间维度 | 4个（小时/周末/季节/天气） |
| 综合系数范围 | 0.3-1.8 |
| 数据真实性 | ⭐⭐⭐⭐⭐ |

---

## 🔍 技术原理

### 综合系数计算

```python
def get_combined_factor(self, weather: str = "晴") -> float:
    """计算综合时间系数"""
    hour_factor = self.get_hour_factor()      # 小时系数
    weekend_factor = self.get_weekend_factor() # 周末系数
    season_factor = self.get_season_factor()   # 季节系数
    weather_factor = self.get_weather_factor(weather) # 天气系数

    # 综合系数 = 各系数相乘
    combined = hour_factor * weekend_factor * season_factor * weather_factor

    # 添加随机波动(±5%)
    random_variation = 1.0 + random.uniform(-0.05, 0.05)

    return round(combined * random_variation, 3)
```

### 小时系数曲线

```
客流量
  ↑
1.5│       ┌───────┐
1.3│   ────┘       └─────
1.0│─┘                     └───
0.7│                             └─
0.5│
  └──────────────────────────────→ 小时
    0  6  10  14  18  24
```

---

## 💡 项目应用

### 代码位置

**主文件**: [backend/app/services/mock_service.py:16-179](../../backend/app/services/mock_service.py#L16-L179)

### 实现细节

```python
# backend/app/services/mock_service.py:16-179
class TimeAwareGenerator:
    """时间感知数据生成器"""

    def get_hour_factor(self) -> float:
        """小时系数 - 模拟一天中的客流变化"""
        hour = self.now.hour

        if 10 <= hour <= 16:
            return 1.3 + (hour - 10) * 0.05  # 高峰期
        elif 8 <= hour <= 9:
            return 1.1 + (hour - 8) * 0.05   # 上午次高峰
        elif 17 <= hour <= 18:
            return 1.2 - (hour - 17) * 0.1   # 傍晚次高峰
        elif 6 <= hour <= 7:
            return 0.7  # 早晨
        elif 19 <= hour <= 21:
            return 0.9 - (hour - 19) * 0.1  # 晚间
        else:
            return 0.5  # 深夜

    def get_weekend_factor(self) -> float:
        """周末系数"""
        weekday = self.now.weekday()

        if weekday == 5:  # 周六
            return 1.35
        elif weekday == 6:  # 周日
            return 1.25
        else:  # 工作日
            return 1.0

    def get_season_factor(self) -> float:
        """季节系数"""
        month = self.now.month

        if month in [7, 8]:
            return 1.25  # 暑期
        elif month in [4, 5, 9, 10]:
            return 1.15  # 春秋季
        elif month in [12, 1, 2]:
            return 0.8   # 冬季
        else:
            return 1.0

    def get_weather_factor(self, condition: str = "晴") -> float:
        """天气系数"""
        if condition in ["晴", "多云"]:
            return 1.0
        elif condition == "阴":
            return 0.9
        elif condition == "小雨":
            return 0.7
        elif condition in ["中雨", "大雨", "暴雨", "雪"]:
            return 0.5
        else:
            return 1.0
```

---

## 🎯 演示话术

### 开场介绍（30秒）

```
"我们的Mock数据不是静态的，
而是时间感知的动态数据。

客流量会根据当前时间、
是否周末、季节、天气等因素变化，
更贴近真实情况。"
```

### 深度讲解（1分钟）

```
"时间感知数据生成器考虑四个维度：

第一维度：小时系数
白天10-16点是高峰期，客流量增加30-50%
深夜只有50%的客流量

第二维度：周末系数
周六客流增加35%，周日增加25%

第三维度：季节系数
暑期客流增加25%，春秋季增加15%，冬季减少20%

第四维度：天气系数
暴雨天客流减少50%，小雨天减少30%

所有系数相乘，得到综合系数，
再应用到客流量计算中。

这样生成的数据更加真实可信。"
```

---

## 📊 对比优势

| 维度 | 静态Mock | 时间感知Mock |
|-----|---------|-------------|
| 数据真实性 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| 演示效果 | 一般 | 优秀 |
| 用户体验 | 差 | 好 |

---

## 🏆 总结

**核心价值**：Mock数据也是"智能"的，时间感知让数据更真实。

**演示建议**：在不同时间段展示不同的客流量数据。

---

**文档版本**: v1.0
**最后更新**: 2026-01-02
**作者**: 山西文旅智能体团队
