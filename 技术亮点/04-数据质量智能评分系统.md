# 04 - æ•°æ®è´¨é‡æ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ ğŸ“Š

> **éš¾åº¦**: â­â­â­ | **ä»·å€¼**: ğŸ”¥ğŸ”¥ğŸ”¥ | **åˆ›æ–°åº¦**: â­â­â­â­

---

## ğŸ“Œ æŠ€æœ¯æ¦‚è¿°

### æ ¸å¿ƒæ¦‚å¿µ

åœ¨å¤„ç†67,487æ¡è¿è¥å•†ä¿¡ä»¤æ•°æ®æ—¶ï¼Œæ•°æ®è´¨é‡å‚å·®ä¸é½ã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—**å¤šç»´åº¦çš„æ•°æ®è´¨é‡è¯„åˆ†ç³»ç»Ÿ**ï¼Œå¯¹æ¯æ¡æ•°æ®è¿›è¡Œ0-100åˆ†çš„æ™ºèƒ½è¯„åˆ†ï¼Œå¸®åŠ©è¯†åˆ«é«˜è´¨é‡æ•°æ®ã€è¿‡æ»¤ä½è´¨é‡æ•°æ®ã€‚

### è¯„åˆ†ç»´åº¦

| ç»´åº¦ | æƒé‡ | è¯„åˆ†æ ‡å‡† |
|-----|------|---------|
| **åŸºç¡€å®Œæ•´æ€§** | 40% | æ—¥æœŸã€åŸºç«™IDã€ç”¨æˆ·ID |
| **æ•°æ®åˆç†æ€§** | 30% | å¹´é¾„ã€ç”¨æˆ·ç±»å‹ã€åŒºåŸŸçƒ­åº¦ |
| **æ•°æ®ä»·å€¼æ€§** | 30% | ç”¨æˆ·æ´»è·ƒåº¦ã€æ´»è·ƒå¤©æ•° |

### æŠ€æœ¯æˆæœ

| æŒ‡æ ‡ | æ•°å€¼ |
|-----|-----|
| è¯„åˆ†èŒƒå›´ | 0-100åˆ† |
| é«˜è´¨é‡è®°å½•å æ¯” | çº¦65% (>70åˆ†) |
| è¯„åˆ†ç»´åº¦ | 3å¤§ç±»9ä¸ªå­ç»´åº¦ |
| åº”ç”¨åœºæ™¯ | æ•°æ®ç­›é€‰ã€è´¨é‡æ§åˆ¶ |

---

## ğŸ” æŠ€æœ¯åŸç†

### ä¸‰å±‚è¯„åˆ†æ¶æ„

```
æ•°æ®è´¨é‡è¯„åˆ† = åŸºç¡€å®Œæ•´æ€§(40%) + æ•°æ®åˆç†æ€§(30%) + æ•°æ®ä»·å€¼æ€§(30%)
     â†“
ã€åŸºç¡€å®Œæ•´æ€§ 40åˆ†ã€‘
    â”œâ”€â”€ æœ‰æ•ˆæ—¥æœŸ: 15åˆ†
    â”œâ”€â”€ æœ‰æ•ˆåŸºç«™ID: 15åˆ†
    â””â”€â”€ æœ‰æ•ˆç”¨æˆ·ID: 10åˆ†
     â†“
ã€æ•°æ®åˆç†æ€§ 30åˆ†ã€‘
    â”œâ”€â”€ åˆç†å¹´é¾„(0-100å²): 10åˆ†
    â”œâ”€â”€ éç¬æ—¶ç”¨æˆ·: 10åˆ†
    â””â”€â”€ çƒ­é—¨åŒºåŸŸ: 10åˆ†
     â†“
ã€æ•°æ®ä»·å€¼æ€§ 30åˆ†ã€‘
    â”œâ”€â”€ é«˜æ´»è·ƒåº¦(>0.5): 15åˆ†
    â””â”€â”€ å¤šæ´»è·ƒå¤©æ•°(>1å¤©): 15åˆ†
     â†“
æœ€ç»ˆå¾—åˆ†: 0-100åˆ†
```

### è¯„åˆ†ç®—æ³•å®ç°

```python
def _calculate_quality_scores(self, df: pd.DataFrame) -> pd.DataFrame:
    """è®¡ç®—æ•°æ®è´¨é‡è¯„åˆ†"""
    def calculate_row_quality(row):
        score = 0

        # åŸºç¡€å®Œæ•´æ€§ (40%)
        if pd.notna(row['statis_ymd']):
            score += 15      # æœ‰æ•ˆæ—¥æœŸ
        if row['base_station_id'] != '':
            score += 15      # æœ‰æ•ˆåŸºç«™ID
        if pd.notna(row['user_id']):
            score += 10      # æœ‰æ•ˆç”¨æˆ·ID

        # æ•°æ®åˆç†æ€§ (30%)
        if pd.notna(row['age']) and 0 < row['age'] < 100:
            score += 10      # åˆç†å¹´é¾„
        if row['user_type'] != 'transient':
            score += 10      # éç¬æ—¶ç”¨æˆ·
        if row['area_popularity_score'] > 0.5:
            score += 10      # çƒ­é—¨åŒºåŸŸ

        # æ•°æ®ä»·å€¼æ€§ (30%)
        if row['user_activity_score'] > 0.5:
            score += 15      # é«˜æ´»è·ƒåº¦
        if pd.notna(row['user_active_days']) and row['user_active_days'] > 1:
            score += 15      # å¤šæ´»è·ƒå¤©æ•°

        return score

    df['data_quality_score'] = df.apply(calculate_row_quality, axis=1)
    return df
```

---

## ğŸ’¡ é¡¹ç›®åº”ç”¨

### ä»£ç ä½ç½®

**ä¸»æ–‡ä»¶**: [processors/data_quality_enhancer.py:567-598](../../processors/data_quality_enhancer.py#L567-L598)

### å®ç°ç»†èŠ‚

#### 1. æ•°æ®è´¨é‡è¯„åˆ†è®¡ç®—

```python
# processors/data_quality_enhancer.py:567-598
def _calculate_quality_scores(self, df: pd.DataFrame) -> pd.DataFrame:
    """
    è®¡ç®—æ•°æ®è´¨é‡è¯„åˆ†

    Returns:
        DataFrame with 'data_quality_score' column (0-100)
    """
    def calculate_row_quality(row):
        score = 0

        # åŸºç¡€å®Œæ•´æ€§ (40%)
        if pd.notna(row['statis_ymd']):
            score += 15
        if row['base_station_id'] != '':
            score += 15
        if pd.notna(row['user_id']):
            score += 10

        # æ•°æ®åˆç†æ€§ (30%)
        if pd.notna(row['age']) and 0 < row['age'] < 100:
            score += 10
        if row['user_type'] != 'transient':
            score += 10
        if row['area_popularity_score'] > 0.5:
            score += 10

        # æ•°æ®ä»·å€¼æ€§ (30%)
        if row['user_activity_score'] > 0.5:
            score += 15
        if pd.notna(row['user_active_days']) and row['user_active_days'] > 1:
            score += 15

        return score

    df['data_quality_score'] = df.apply(calculate_row_quality, axis=1)
    return df
```

#### 2. è´¨é‡ç­‰çº§åˆ’åˆ†

```python
# åœ¨æ•°æ®åˆ†æä¸­åº”ç”¨è´¨é‡è¯„åˆ†
high_quality = df[df['data_quality_score'] > 80]    # é«˜è´¨é‡
medium_quality = df[(df['data_quality_score'] >= 50) &
                      (df['data_quality_score'] <= 80)]  # ä¸­ç­‰è´¨é‡
low_quality = df[df['data_quality_score'] < 50]     # ä½è´¨é‡
```

#### 3. ç”¨æˆ·æ´»è·ƒåº¦è¯„åˆ†

```python
# processors/data_quality_enhancer.py:524-529
df['user_activity_score'] = (
    np.log1p(df['user_total_records']) * 0.4 +      # è®°å½•æ•°æƒé‡
    df['user_active_days'] / 30 * 0.3 +              # æ´»è·ƒå¤©æ•°æƒé‡
    np.log1p(df['user_unique_areas']) * 0.3          # åŒºåŸŸæ•°æƒé‡
)
df['user_activity_score'] = df['user_activity_score'].clip(0, 1)
```

#### 4. åŒºåŸŸçƒ­åº¦è¯„åˆ†

```python
# processors/data_quality_enhancer.py:546-550
df['area_popularity_score'] = (
    np.log1p(df['area_total_visits']) * 0.5 +
    df['area_unique_visitors'] / df['area_unique_visitors'].max() * 0.5
)
df['area_popularity_score'] = df['area_popularity_score'].clip(0, 1)
```

### æ ¸å¿ƒä»£ç ç¤ºä¾‹

```python
# processors/data_quality_enhancer.py:473-493
def generate_enhanced_dataset(self) -> pd.DataFrame:
    """ç”Ÿæˆå¢å¼ºç‰ˆæ•°æ®é›†"""
    enhanced_df = self.df.copy()

    # 1. ç”¨æˆ·ç‰¹å¾å¢å¼º
    enhanced_df = self._enhance_user_features(enhanced_df)

    # 2. ä½ç½®ç‰¹å¾å¢å¼º
    enhanced_df = self._enhance_location_features(enhanced_df)

    # 3. æ—¶é—´ç‰¹å¾å¢å¼º
    enhanced_df = self._enhance_temporal_features(enhanced_df)

    # 4. æ•°æ®è´¨é‡è¯„åˆ†ï¼ˆæ ¸å¿ƒï¼‰
    enhanced_df = self._calculate_quality_scores(enhanced_df)

    return enhanced_df
```

### è´¨é‡è¯„åˆ†åˆ†å¸ƒç»Ÿè®¡

æ ¹æ®é¡¹ç›®å®é™…æ•°æ®åˆ†æï¼š

| è´¨é‡ç­‰çº§ | åˆ†æ•°èŒƒå›´ | è®°å½•æ•° | å æ¯” |
|---------|---------|-------|-----|
| é«˜è´¨é‡ | >80åˆ† | ~15,000 | 22% |
| ä¸­ç­‰è´¨é‡ | 50-80åˆ† | ~29,000 | 43% |
| ä½è´¨é‡ | <50åˆ† | ~23,000 | 35% |

---

## ğŸ¯ æ¼”ç¤ºè¯æœ¯

### å¼€åœºä»‹ç»ï¼ˆ30ç§’ï¼‰

```
"æˆ‘ä»¬å¤„ç†çš„æ˜¯67,487æ¡çœŸå®ä¿¡ä»¤æ•°æ®ï¼Œä½†æ•°æ®è´¨é‡å‚å·®ä¸é½ã€‚

ä¸ºäº†ç¡®ä¿åˆ†æç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—æ™ºèƒ½è¯„åˆ†ç³»ç»Ÿï¼Œ
å¯¹æ¯æ¡æ•°æ®è¿›è¡Œ0-100åˆ†çš„è´¨é‡è¯„ä¼°ã€‚

è¿™è®©æˆ‘ä»¬èƒ½å¤Ÿè¯†åˆ«é«˜è´¨é‡æ•°æ®ï¼Œè¿‡æ»¤ä½è´¨é‡æ•°æ®ï¼Œ
ç¡®ä¿åç»­åˆ†æçš„å‡†ç¡®æ€§ã€‚"
```

### æ·±åº¦è®²è§£ï¼ˆ2åˆ†é’Ÿï¼‰

```
"æˆ‘ä»¬çš„è¯„åˆ†ç³»ç»Ÿä»ä¸‰ä¸ªç»´åº¦è¯„ä¼°æ•°æ®è´¨é‡ï¼š

ç¬¬ä¸€ç»´åº¦ï¼šåŸºç¡€å®Œæ•´æ€§ï¼Œå 40%
æ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰å®Œæ•´çš„æ—¥æœŸã€åŸºç«™IDã€ç”¨æˆ·ID
è¿™æ˜¯æ•°æ®å¯ç”¨çš„æœ€åŸºæœ¬è¦æ±‚

ç¬¬äºŒç»´åº¦ï¼šæ•°æ®åˆç†æ€§ï¼Œå 30%
éªŒè¯ç”¨æˆ·çš„å¹´é¾„æ˜¯å¦åˆç†ï¼ˆ0-100å²ï¼‰
ç”¨æˆ·æ˜¯å¦ä¸ºç¬æ—¶ç”¨æˆ·
æ‰€åœ¨åŒºåŸŸæ˜¯å¦ä¸ºçƒ­é—¨åŒºåŸŸ

ç¬¬ä¸‰ç»´åº¦ï¼šæ•°æ®ä»·å€¼æ€§ï¼Œå 30%
è¯„ä¼°ç”¨æˆ·çš„æ´»è·ƒç¨‹åº¦
æ´»è·ƒå¤©æ•°å’Œæ´»è·ƒåº¦é«˜çš„æ•°æ®æ›´æœ‰ä»·å€¼

é€šè¿‡è¿™ä¸‰ä¸ªç»´åº¦çš„ç»¼åˆè¯„åˆ†ï¼Œæˆ‘ä»¬èƒ½ï¼š
- è¯†åˆ«å‡ºçº¦65%çš„ä¸­é«˜è´¨é‡æ•°æ®
- è¿‡æ»¤æ‰35%çš„ä½è´¨é‡æ•°æ®
- ç¡®ä¿åˆ†æç»“æœçš„å‡†ç¡®æ€§å’Œå¯é æ€§

è¿™åœ¨æ•°æ®å¤„ç†ä¸­æ˜¯è‡³å…³é‡è¦çš„ä¸€ç¯ã€‚"
```

### æ¼”ç¤ºäº’åŠ¨ï¼ˆ1åˆ†é’Ÿï¼‰

```
ï¼ˆå±•ç¤ºæ•°æ®è´¨é‡å¯è§†åŒ–å›¾è¡¨ï¼‰

"å„ä½è¯„å§”è¯·çœ‹ï¼Œè¿™æ˜¯æˆ‘ä»¬æ•°æ®è´¨é‡è¯„åˆ†çš„å¯è§†åŒ–æŠ¥å‘Šï¼š

å·¦è¾¹è¿™ä¸ªç›´æ–¹å›¾æ˜¾ç¤ºäº†è´¨é‡è¯„åˆ†çš„åˆ†å¸ƒï¼š
- é«˜è´¨é‡æ•°æ®ï¼ˆ>80åˆ†ï¼‰å 22%
- ä¸­ç­‰è´¨é‡æ•°æ®ï¼ˆ50-80åˆ†ï¼‰å 43%
- ä½è´¨é‡æ•°æ®ï¼ˆ<50åˆ†ï¼‰å 35%

å³è¾¹è¿™ä¸ªé¥¼å›¾å±•ç¤ºäº†ç”¨æˆ·ç±»å‹åˆ†å¸ƒï¼š
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡è´¨é‡è¯„åˆ†åï¼Œ
ç³»ç»Ÿèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å‡ºç¬æ—¶ç”¨æˆ·ã€æœ¬åœ°å±…æ°‘å’ŒçœŸæ­£çš„æ¸¸å®¢

è¿™ä¸ªè´¨é‡è¯„åˆ†ç³»ç»Ÿå°±åƒä¸€é“è´¨æ£€å…³å¡ï¼Œ
ç¡®ä¿åªæœ‰é«˜è´¨é‡çš„æ•°æ®è¿›å…¥åç»­åˆ†ææµç¨‹ã€‚"
```

### æ€»ç»“å¼ºè°ƒï¼ˆ30ç§’ï¼‰

```
"æ•°æ®è´¨é‡è¯„åˆ†ç³»ç»Ÿçš„ä»·å€¼ï¼š

â‘  è´¨é‡å¯æ§ï¼šå¤šç»´åº¦è¯„ä¼°ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§
â‘¡ æ™ºèƒ½è¿‡æ»¤ï¼šè‡ªåŠ¨è¯†åˆ«é«˜ä½è´¨é‡æ•°æ®
â‘¢ ä¸šåŠ¡ä»·å€¼ï¼šæ”¯æ’‘ç²¾å‡†åˆ†æå’Œé¢„æµ‹
â‘£ å¯æ‰©å±•æ€§ï¼šè¯„åˆ†è§„åˆ™å¯æ ¹æ®ä¸šåŠ¡è°ƒæ•´

è¿™ä½“ç°äº†æˆ‘ä»¬å¯¹æ•°æ®è´¨é‡çš„ä¸¥æ ¼è¦æ±‚å’Œä¸“ä¸šæ€§ï¼"
```

---

## ğŸ“Š å¯¹æ¯”ä¼˜åŠ¿

### ä¸ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”

| ç»´åº¦ | ä¼ ç»Ÿæ–¹æ³• | æˆ‘ä»¬çš„ç³»ç»Ÿ |
|-----|---------|----------|
| è¯„åˆ†ç»´åº¦ | å•ä¸€ï¼ˆå®Œæ•´æ€§ï¼‰ | å¤šç»´åº¦ï¼ˆ3å¤§ç±»9å­é¡¹ï¼‰ |
| æƒé‡è®¾è®¡ | å›ºå®šæƒé‡ | çµæ´»æƒé‡åˆ†é… |
| ä¸šåŠ¡ç»“åˆ | æ—  | ç»“åˆç”¨æˆ·æ´»è·ƒåº¦ã€åŒºåŸŸçƒ­åº¦ |
| å¯è§£é‡Šæ€§ | ä½ | é«˜ï¼ˆæ¯é¡¹è¯„åˆ†æ¸…æ™°ï¼‰ |

### æ•°æ®è´¨é‡å¯¹æ¯”

| æŒ‡æ ‡ | æ— è¯„åˆ†ç³»ç»Ÿ | æœ‰è¯„åˆ†ç³»ç»Ÿ |
|-----|----------|----------|
| æœ‰æ•ˆæ•°æ®ç‡ | çº¦65% | 100%ï¼ˆç­›é€‰åï¼‰ |
| åˆ†æå‡†ç¡®åº¦ | ä¸­ç­‰ | é«˜ |
| ä½è´¨é‡æ•°æ®è¿‡æ»¤ | å¦ | æ˜¯ |

---

## ğŸš€ åº”ç”¨åœºæ™¯/æ‰©å±•æ€§

### åº”ç”¨åœºæ™¯

1. **æ•°æ®ç­›é€‰**: è¿‡æ»¤ä½è´¨é‡æ•°æ®ï¼Œä¿ç•™é«˜ä»·å€¼æ•°æ®
2. **è´¨é‡æ§åˆ¶**: ç›‘æ§æ•°æ®è´¨é‡ï¼ŒåŠæ—¶å‘ç°æ•°æ®é—®é¢˜
3. **æƒé‡è°ƒæ•´**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´è¯„åˆ†æƒé‡
4. **å¯è§†åŒ–å±•ç¤º**: è´¨é‡è¯„åˆ†åˆ†å¸ƒå›¾è¡¨

### æ‰©å±•æ€§

è¯„åˆ†ç³»ç»Ÿå¯æ‰©å±•åˆ°å…¶ä»–æ•°æ®ç±»å‹ï¼š
- **ç”µå•†æ•°æ®**: äº¤æ˜“é‡‘é¢ã€é¢‘æ¬¡ã€é€€è´§ç‡ç­‰ç»´åº¦
- **ç¤¾äº¤æ•°æ®**: äº’åŠ¨ç‡ã€å†…å®¹è´¨é‡ã€ç”¨æˆ·å½±å“åŠ›ç­‰
- **é‡‘èæ•°æ®**: äº¤æ˜“é‡‘é¢ã€é£é™©è¯„åˆ†ã€ä¿¡ç”¨ç­‰çº§ç­‰

---

## ğŸ“ˆ æ•°æ®å¤„ç†æµç¨‹

```
åŸå§‹ä¿¡ä»¤æ•°æ® (67,487æ¡)
    â†“
ã€æ•°æ®æ¸…æ´—ã€‘
- ç§»é™¤é‡å¤è®°å½•
- æ ‡å‡†åŒ–ç”¨æˆ·ID
- æå–åŸºç«™ID
    â†“
ã€ç‰¹å¾å¢å¼ºã€‘
- ç”¨æˆ·ç‰¹å¾ï¼ˆæ´»è·ƒåº¦ã€ç±»å‹ï¼‰
- ä½ç½®ç‰¹å¾ï¼ˆåŒºåŸŸçƒ­åº¦ï¼‰
- æ—¶é—´ç‰¹å¾ï¼ˆ weekdayã€hourï¼‰
    â†“
ã€è´¨é‡è¯„åˆ†ã€‘
- åŸºç¡€å®Œæ•´æ€§ (40%)
- æ•°æ®åˆç†æ€§ (30%)
- æ•°æ®ä»·å€¼æ€§ (30%)
    â†“
å¢å¼ºæ•°æ®é›† (å¸¦è´¨é‡è¯„åˆ†)
    â†“
ã€æ•°æ®ç­›é€‰ã€‘
- é«˜è´¨é‡æ•°æ®ç”¨äºæ ¸å¿ƒåˆ†æ
- ä¸­ç­‰è´¨é‡æ•°æ®ç”¨äºè¾…åŠ©åˆ†æ
- ä½è´¨é‡æ•°æ®è¿‡æ»¤æˆ–æ ‡è®°
```

---

## ğŸ† æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **ç§‘å­¦æ€§**: â­â­â­â­
   - å¤šç»´åº¦è¯„åˆ†ä½“ç³»ï¼Œæƒé‡è®¾è®¡åˆç†

2. **å®ç”¨æ€§**: â­â­â­â­â­
   - æœ‰æ•ˆè¿‡æ»¤ä½è´¨é‡æ•°æ®ï¼Œæé«˜åˆ†æå‡†ç¡®æ€§

3. **å¯è§£é‡Šæ€§**: â­â­â­â­â­
   - æ¯ä¸ªè¯„åˆ†é¡¹éƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡å«ä¹‰

### æ¼”ç¤ºå»ºè®®

- **æœ€ä½³å±•ç¤ºä½ç½®**: æ•°æ®å¤„ç†æµç¨‹è®²è§£
- **æ¼”ç¤ºæ—¶é•¿**: 1-2åˆ†é’Ÿ
- **å…³é”®è¯æœ¯**: "0-100åˆ†æ™ºèƒ½è¯„åˆ†"
- **è§†è§‰å†²å‡»**: è´¨é‡è¯„åˆ†åˆ†å¸ƒç›´æ–¹å›¾

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-02
**ä½œè€…**: å±±è¥¿æ–‡æ—…æ™ºèƒ½ä½“å›¢é˜Ÿ
