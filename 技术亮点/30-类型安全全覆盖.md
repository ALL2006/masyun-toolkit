# 30 - ç±»å‹å®‰å…¨å…¨è¦†ç›– ğŸ”’

> **éš¾åº¦**: â­â­â­ | **ä»·å€¼**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | **åˆ›æ–°åº¦**: â­â­â­â­

---

## ğŸ“Œ æŠ€æœ¯æ¦‚è¿°

### æ ¸å¿ƒæ¦‚å¿µ/é—®é¢˜èƒŒæ™¯

ç±»å‹å®‰å…¨æ˜¯æŒ‡åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥é˜²æ­¢ç±»å‹é”™è¯¯ï¼Œåœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°æ½œåœ¨çš„é—®é¢˜ã€‚TypeScript ä¸º JavaScript æ·»åŠ äº†é™æ€ç±»å‹æ£€æŸ¥ï¼Œå¤§å¹…æå‡äº†ä»£ç çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

åœ¨å±±è¥¿æ–‡æ—…æ™ºèƒ½ä½“é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å®ç°äº† 100% çš„ TypeScript ç±»å‹è¦†ç›–ç‡ï¼ŒåŒ…æ‹¬å‰ç«¯æ‰€æœ‰ç»„ä»¶ã€æœåŠ¡å±‚ã€çŠ¶æ€ç®¡ç†ï¼Œä»¥åŠåç«¯çš„ Pydantic æ•°æ®éªŒè¯ï¼Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„ç±»å‹å®‰å…¨ã€‚

### æŠ€æœ¯æˆæœ/æ•°æ®

| æŒ‡æ ‡ | æ•°æ® | è¯´æ˜ |
|------|------|------|
| TSè¦†ç›–ç‡ | 100% | æ‰€æœ‰.tsx/.tsæ–‡ä»¶ |
| ç±»å‹å®šä¹‰ | 20+ | æ¥å£å’Œç±»å‹åˆ«å |
| ç¼–è¯‘æ—¶æ£€æŸ¥ | å¯ç”¨ | strictæ¨¡å¼ |
| è¿è¡Œæ—¶éªŒè¯ | Pydantic | åç«¯æ•°æ®éªŒè¯ |

---

## ğŸ” æŠ€æœ¯åŸç†

### æ ¸å¿ƒåŸç†/ç®—æ³•è®¾è®¡

ç±»å‹å®‰å…¨åŸºäºä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼š

1. **é™æ€ç±»å‹æ£€æŸ¥**
   - TypeScript ç¼–è¯‘å™¨
   - ç±»å‹æ¨æ–­
   - æ³›å‹æ”¯æŒ

2. **æ¥å£å®šä¹‰**
   - APIè¯·æ±‚/å“åº”ç±»å‹
   - ç»„ä»¶Propsç±»å‹
   - çŠ¶æ€ç±»å‹

3. **è¿è¡Œæ—¶éªŒè¯**
   - Pydanticæ¨¡å‹
   - è‡ªåŠ¨ç±»å‹è½¬æ¢
   - é”™è¯¯æç¤º

### æŠ€æœ¯æ–¹æ¡ˆ/æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç±»å‹å®‰å…¨æ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  å‰ç«¯ç±»å‹ç³»ç»Ÿ (TypeScript)                          â”‚
â”‚       â”‚                                             â”‚
â”‚       â”œâ”€â”€ ç±»å‹å®šä¹‰æ–‡ä»¶ (types/index.ts)             â”‚
â”‚       â”‚    â”œâ”€â”€ æ¥å£å®šä¹‰                             â”‚
â”‚       â”‚    â”œâ”€â”€ ç±»å‹åˆ«å                             â”‚
â”‚       â”‚    â””â”€â”€ æšä¸¾ç±»å‹                             â”‚
â”‚       â”‚                                             â”‚
â”‚       â”œâ”€â”€ ç»„ä»¶ç±»å‹                                  â”‚
â”‚       â”‚    â”œâ”€â”€ Propsç±»å‹                            â”‚
â”‚       â”‚    â”œâ”€â”€ Stateç±»å‹                            â”‚
â”‚       â”‚    â””â”€â”€ è¿”å›å€¼ç±»å‹                           â”‚
â”‚       â”‚                                             â”‚
â”‚       â””â”€â”€ APIç±»å‹                                   â”‚
â”‚            â”œâ”€â”€ è¯·æ±‚ç±»å‹                              â”‚
â”‚            â””â”€â”€ å“åº”ç±»å‹                              â”‚
â”‚       â”‚                                             â”‚
â”‚  åç«¯ç±»å‹ç³»ç»Ÿ (Python + Pydantic)                   â”‚
â”‚       â”‚                                             â”‚
â”‚       â”œâ”€â”€ Pydanticæ¨¡å‹                              â”‚
â”‚       â”‚    â”œâ”€â”€ è¯·æ±‚éªŒè¯                             â”‚
â”‚       â”‚    â”œâ”€â”€ å“åº”åºåˆ—åŒ–                           â”‚
â”‚       â”‚    â””â”€â”€ è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ                         â”‚
â”‚       â”‚                                             â”‚
â”‚       â””â”€â”€ ç±»å‹æç¤º                                  â”‚
â”‚            â”œâ”€â”€ å‡½æ•°å‚æ•°ç±»å‹                          â”‚
â”‚            â””â”€â”€ è¿”å›å€¼ç±»å‹                            â”‚
â”‚                                                     â”‚
â”‚  ç¼–è¯‘/è¿è¡Œæ—¶æ£€æŸ¥                                     â”‚
â”‚       â”‚                                             â”‚
â”‚       â”œâ”€â”€ TypeScriptç¼–è¯‘å™¨ (å‰ç«¯)                   â”‚
â”‚       â”œâ”€â”€ PydanticéªŒè¯å™¨ (åç«¯)                     â”‚
â”‚       â””â”€â”€ ç±»å‹é”™è¯¯æ‹¦æˆª                              â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ é¡¹ç›®åº”ç”¨

### ä»£ç ä½ç½®

**æ ¸å¿ƒæ–‡ä»¶ï¼š**
- ç±»å‹å®šä¹‰ï¼š[frontend/src/types/index.ts](../../frontend/src/types/index.ts#L1-L99)
- Pydanticæ¨¡å‹ï¼š[backend/app/models/common.py](../../backend/app/models/common.py)

### å®ç°ç»†èŠ‚

#### 1. å‰ç«¯ç±»å‹å®šä¹‰

```typescript
// frontend/src/types/index.ts:1-99
/**
 * ç±»å‹å®šä¹‰
 */
import type { ReactNode } from 'react';

// æ™¯ç‚¹ç±»å‹
export interface Attraction {
  id: string;
  name: string;
  city: string;
  description: string;
  rating: number;
  tags: string[];
  image_url?: string;
}

// èŠå¤©è¯·æ±‚
export interface ChatRequest {
  message: string;
  role: 'tourist' | 'enterprise' | 'government';
  session_id?: string;
}

// èŠå¤©å“åº”
export interface ChatResponse {
  reply: string;
  suggestions: string[];
  data?: Record<string, unknown>;
}

// èŠå¤©æ¶ˆæ¯
export interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
  suggestions?: string[];
}

// è¡Œç¨‹è§„åˆ’è¯·æ±‚
export interface ItineraryRequest {
  days: number;
  preferences: string;
  start_city: string;
}

// ä»ªè¡¨æ¿ç»Ÿè®¡
export interface DashboardStats {
  total_visitors: number;
  today_visitors: number;
  forecast_visitors: number;
  alert_count: number;
  popular_spots: Array<{
    name: string;
    visitors: number;
    trend: string;
  }>;
}

// ç”¨æˆ·è§’è‰²
export type UserRole = 'tourist' | 'enterprise' | 'government';
```

#### 2. ç»„ä»¶Propsç±»å‹

```typescript
// frontend/src/components/DataSourceSwitcher.tsx:9-83
import React from 'react';
import { useDataSourceStore, type DataSource } from '../stores/dataSourceStore';

const DataSourceSwitcher: React.FC = () => {  // ä½¿ç”¨React.FCç±»å‹
  const { dataSource, setDataSource } = useDataSourceStore();

  // ç±»å‹æ˜ç¡®
  const options = [
    {
      label: (
        <Space size={8}>
          <DatabaseOutlined />
          <span>æ¨¡æ‹Ÿæ•°æ®</span>
        </Space>
      ),
      value: 'mock' as DataSource,  // ç±»å‹æ–­è¨€
    },
    // ...
  ];

  return (
    <Space size={12}>
      <Select
        value={dataSource}
        onChange={setDataSource}
        options={options}
      />
    </Space>
  );
};
```

#### 3. APIæœåŠ¡ç±»å‹

```typescript
// frontend/src/services/api.ts:1-74
import axios, { type AxiosInstance, type AxiosRequestConfig } from 'axios';

// é€šç”¨APIå“åº”ç±»å‹
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
  error?: string;
  meta?: {
    data_source?: string;
    timestamp?: string;
  };
}

// APIè¯·æ±‚å°è£…
export const request = async <T>(
  config: AxiosRequestConfig
): Promise<ApiResponse<T>> => {
  try {
    const response = await apiClient.request<ApiResponse<T>>(config);
    return response;
  } catch (error) {
    throw error;
  }
};
```

#### 4. åç«¯Pydanticæ¨¡å‹

```python
# backend/app/models/common.py
from pydantic import BaseModel
from typing import Optional, List, Dict, Any

class ChatRequest(BaseModel):
    """èŠå¤©è¯·æ±‚æ¨¡å‹"""
    message: str
    role: str  # 'tourist' | 'enterprise' | 'government'
    session_id: Optional[str] = None

class ChatResponse(BaseModel):
    """èŠå¤©å“åº”æ¨¡å‹"""
    reply: str
    suggestions: List[str]
    data: Optional[Dict[str, Any]] = None

class ApiResponse(BaseModel):
    """ç»Ÿä¸€APIå“åº”æ ¼å¼"""
    success: bool
    data: Optional[Any] = None
    message: Optional[str] = None
    error: Optional[str] = None
    meta: Optional[Dict[str, Any]] = None
```

#### 5. TypeScripté…ç½®

```json
// tsconfig.app.json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,  // å¯ç”¨ä¸¥æ ¼æ¨¡å¼
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
```

### æ ¸å¿ƒä»£ç ç¤ºä¾‹

```typescript
/**
 * ç±»å‹å®‰å…¨å®Œæ•´ç¤ºä¾‹
 */

// 1. ç±»å‹å®šä¹‰
interface User {
  id: string;
  name: string;
  age: number;
  email: string;
  role: 'admin' | 'user' | 'guest';
}

interface ApiResponse<T> {
  success: boolean;
  data: T;
  message: string;
}

// 2. ç±»å‹å®‰å…¨çš„APIè°ƒç”¨
async function fetchUser(userId: string): Promise<ApiResponse<User>> {
  const response = await fetch(`/api/users/${userId}`);
  const data: ApiResponse<User> = await response.json();

  // TypeScriptä¼šæ£€æŸ¥ç±»å‹æ˜¯å¦åŒ¹é…
  if (data.success) {
    console.log(data.data.name);  // ç±»å‹å®‰å…¨ï¼Œæœ‰è‡ªåŠ¨è¡¥å…¨
  }

  return data;
}

// 3. ç±»å‹å®‰å…¨çš„ç»„ä»¶
interface UserCardProps {
  user: User;
  onEdit?: (user: User) => void;
}

const UserCard: React.FC<UserCardProps> = ({ user, onEdit }) => {
  return (
    <div>
      <h2>{user.name}</h2>
      <p>å¹´é¾„: {user.age}</p>
      {onEdit && (
        <button onClick={() => onEdit(user)}>ç¼–è¾‘</button>
      )}
    </div>
  );
};

// 4. æ³›å‹ç±»å‹
interface ListResponse<T> {
  items: T[];
  total: number;
  page: number;
}

async function fetchUsers(): Promise<ListResponse<User>> {
  const response = await fetch('/api/users');
  return response.json();
}

// 5. ç±»å‹å®ˆå«
function isAdmin(user: User): user is User & { role: 'admin' } {
  return user.role === 'admin';
}

const user: User = { /* ... */ };
if (isAdmin(user)) {
  // TypeScriptçŸ¥é“è¿™é‡Œuser.roleä¸€å®šæ˜¯'admin'
  console.log(user.role);
}
```

---

## ğŸ¯ æ¼”ç¤ºè¯æœ¯

### å¼€åœºä»‹ç»ï¼ˆ30ç§’ï¼‰

```
"å„ä½è¯„å§”è€å¸ˆï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå®ç°äº†100%çš„ç±»å‹å®‰å…¨è¦†ç›–ã€‚

å‰ç«¯ä½¿ç”¨TypeScriptï¼Œåç«¯ä½¿ç”¨Pydanticï¼Œ
åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ä¸¤å±‚ä¿éšœç±»å‹å®‰å…¨ï¼Œ
å¤§å¹…é™ä½äº†è¿è¡Œæ—¶é”™è¯¯çš„å‘ç”Ÿæ¦‚ç‡ã€‚"
```

### æ·±åº¦è®²è§£ï¼ˆ2åˆ†é’Ÿï¼‰

```
"ç±»å‹å®‰å…¨æ˜¯ä»£ç è´¨é‡çš„é‡è¦ä¿éšœã€‚

**å‰ç«¯æ–¹é¢**ï¼Œæˆ‘ä»¬å¯ç”¨äº†TypeScriptçš„ä¸¥æ ¼æ¨¡å¼ï¼Œ
æ‰€æœ‰çš„ç»„ä»¶ã€æœåŠ¡ã€çŠ¶æ€ç®¡ç†éƒ½æœ‰å®Œæ•´çš„ç±»å‹å®šä¹‰ã€‚

æ¯”å¦‚è¿™ä¸ªChatRequestæ¥å£ï¼Œ
æ˜ç¡®å®šä¹‰äº†messageæ˜¯å­—ç¬¦ä¸²ï¼Œ
roleåªèƒ½æ˜¯ä¸‰ç§è§’è‰²ä¹‹ä¸€ï¼Œ
session_idæ˜¯å¯é€‰çš„ã€‚

å¦‚æœåœ¨ä»£ç ä¸­ä¼ é”™äº†ç±»å‹ï¼Œ
æ¯”å¦‚messageä¼ æˆäº†æ•°å­—ï¼Œ
TypeScriptç¼–è¯‘å™¨ä¼šç«‹å³æŠ¥é”™ï¼Œ
é˜»æ­¢é”™è¯¯ä»£ç è¿›å…¥è¿è¡Œç¯å¢ƒã€‚

**åç«¯æ–¹é¢**ï¼Œæˆ‘ä»¬ä½¿ç”¨Pydanticè¿›è¡Œæ•°æ®éªŒè¯ã€‚
å½“APIæ”¶åˆ°è¯·æ±‚æ—¶ï¼Œ
Pydanticä¼šè‡ªåŠ¨éªŒè¯è¯·æ±‚å‚æ•°çš„ç±»å‹å’Œæ ¼å¼ï¼Œ
å¦‚æœä¸ç¬¦åˆå®šä¹‰ï¼Œä¼šè¿”å›å‹å¥½çš„é”™è¯¯æç¤ºã€‚

è¿™ç§åŒå±‚ç±»å‹ä¿æŠ¤ï¼Œ
è®©æˆ‘ä»¬çš„ç³»ç»Ÿéå¸¸ç¨³å®šå¯é ã€‚"
```

### æ¼”ç¤ºäº’åŠ¨ï¼ˆ1åˆ†é’Ÿï¼‰

```
[æ“ä½œæ¼”ç¤º]

1. å±•ç¤ºç±»å‹å®šä¹‰æ–‡ä»¶
   "å¤§å®¶è¯·çœ‹types/index.tsæ–‡ä»¶ï¼Œ
    è¿™é‡Œå®šä¹‰äº†æ‰€æœ‰æ¥å£å’Œç±»å‹ï¼Œ
    è¦†ç›–äº†æ•´ä¸ªå‰ç«¯åº”ç”¨ã€‚"

2. å±•ç¤ºIDEç±»å‹æç¤º
   "å½“æˆ‘åœ¨IDEä¸­ç¼–å†™ä»£ç æ—¶ï¼Œ
    å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç±»å‹æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ï¼Œ
    è¿™å°±æ˜¯TypeScriptå¸¦æ¥çš„å¥½å¤„ã€‚"

3. å±•ç¤ºç¼–è¯‘æ—¶æ£€æŸ¥
   "å¦‚æœæˆ‘æ•…æ„å†™é”™ç±»å‹ï¼Œ
    æ¯”å¦‚æŠŠstringå†™æˆnumberï¼Œ
    ç¼–è¯‘å™¨ä¼šç«‹å³æŠ¥é”™ï¼Œ
    é˜»æ­¢äº†æ½œåœ¨bugçš„äº§ç”Ÿã€‚"
```

### æ€»ç»“å¼ºè°ƒï¼ˆ30ç§’ï¼‰

```
"é€šè¿‡ç±»å‹å®‰å…¨å…¨è¦†ç›–ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š
- 100%çš„TSè¦†ç›–ç‡
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- è¿è¡Œæ—¶æ•°æ®éªŒè¯
- å¤§å¹…é™ä½bugç‡

è¿™ä½“ç°äº†æˆ‘ä»¬å¯¹ä»£ç è´¨é‡çš„ä¸¥æ ¼æŠŠæ§ã€‚"
```

---

## ğŸ“Š å¯¹æ¯”ä¼˜åŠ¿

### ä¸æ— ç±»å‹ç³»ç»Ÿå¯¹æ¯”

| ç»´åº¦ | æ— ç±»å‹ (JS) | ç±»å‹å®‰å…¨ (TS) |
|-----|------------|--------------|
| ç¼–è¯‘æ—¶æ£€æŸ¥ | æ—  | æœ‰ |
| IDEæç¤º | â­ | â­â­â­â­â­ |
| ä»£ç å¯è¯»æ€§ | â­â­â­ | â­â­â­â­â­ |
| é‡æ„å®‰å…¨æ€§ | â­â­ | â­â­â­â­â­ |

### æŠ€æœ¯ä¼˜åŠ¿

| ç‰¹æ€§ | æœ¬é¡¹ç›® | å…¶ä»–æ–¹æ¡ˆ |
|:----|:-----:|:--------:|
| TSè¦†ç›–ç‡ | 100% | 50-80% |
| ä¸¥æ ¼æ¨¡å¼ | âœ… | âŒ |
| åç«¯éªŒè¯ | Pydantic | æ—  |

---

## ğŸš€ åº”ç”¨åœºæ™¯/æ‰©å±•æ€§

### åº”ç”¨åœºæ™¯

1. **å¤§å‹é¡¹ç›®**
   - å›¢é˜Ÿåä½œ
   - ä»£ç é‡æ„
   - ç»´æŠ¤ä¿éšœ

2. **å…³é”®ç³»ç»Ÿ**
   - é‡‘èç³»ç»Ÿ
   - åŒ»ç–—ç³»ç»Ÿ
   - æ”¿åºœç³»ç»Ÿ

3. **é•¿æœŸç»´æŠ¤**
   - ä»£ç æ¼”è¿›
   - åŠŸèƒ½è¿­ä»£
   - æŠ€æœ¯å€ºåŠ¡æ§åˆ¶

### æ‰©å±•æ€§

ç±»å‹å®‰å…¨å¯æ‰©å±•åˆ°ï¼š
- **Branded Types**ï¼šè‡ªå®šä¹‰ç±»å‹
- **ç±»å‹æ¨å¯¼**ï¼šé«˜çº§ç±»å‹ç³»ç»Ÿ
- **ä»£ç ç”Ÿæˆ**ï¼šåŸºäºç±»å‹ç”Ÿæˆ
- **æ–‡æ¡£ç”Ÿæˆ**ï¼šç±»å‹å³æ–‡æ¡£

---

## ğŸ† æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **å¯é æ€§**: â­â­â­â­â­
   - å‡å°‘è¿è¡Œæ—¶é”™è¯¯

2. **å¯ç»´æŠ¤æ€§**: â­â­â­â­â­
   - ä»£ç è‡ªæ–‡æ¡£åŒ–

3. **å¼€å‘æ•ˆç‡**: â­â­â­â­â­
   - IDEæ™ºèƒ½æç¤º

4. **é‡æ„å®‰å…¨**: â­â­â­â­â­
   - ç±»å‹æ£€æŸ¥ä¿éšœ

### æ¼”ç¤ºå»ºè®®

- **æœ€ä½³å±•ç¤ºä½ç½®**: ä»£ç è´¨é‡è®²è§£ç¯èŠ‚
- **æ¼”ç¤ºæ—¶é•¿**: 1.5 åˆ†é’Ÿ
- **å…³é”®è¯æœ¯**: "100%ç±»å‹å®‰å…¨è¦†ç›–"
- **è§†è§‰å†²å‡»**: å±•ç¤ºTypeScriptç¼–è¯‘é”™è¯¯æç¤º

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-02
**ä½œè€…**: å±±è¥¿æ–‡æ—…æ™ºèƒ½ä½“å›¢é˜Ÿ
